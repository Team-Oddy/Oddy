{% extends 'base.html' %}
{% load static %}

{% block title %}Oddy-my_page{% endblock %}

{% block content %}
<div id="profilePage">
    <span class="my-page-top">마이페이지</span> 
    <img src="{% static 'image/Group 614.png' %}" alt="pink cloud" width="82.87" height="81.3" class="my-page-pink_cloud"> 
    <div>
        <p id="userName">{{ user_profile.nickname }}</p>
    </div>

    <div>
    <div class="my-page-container"></div>
        <a href="{% url 'plans:kakao_logout' %}">로그아웃</a><br>
        <div class="modify-nickname-container">
        <a href="javascript:void(0);" onclick="nicknameEdit()" class="modify-nickname">닉네임 수정</a><br> <!-- 닉네임 수정 링크 -->
        </div>
        <a href="{% url 'plans:test' %}" class="checktraveltype">나의 여행 유형 확인하기</a><br>
    </div>

    <div>
        <h2 class="now-travelgroup">진행중인 여행 모임</h2>
        <!--<ul>
            {% for group in travel_groups %}
                <li>{{ group.travel_name }}</li>
            {% empty %}
                <li>진행 중인 여행 모임이 없습니다.</li>
            {% endfor %}
        </ul>-->
    </div>
    <div>
        <h2 class="past-travelgroup">종료된 여행 모임</h2>
        <!--<ul>
            <li>1</li>
            <li>2</li>
            <li>3</li>
        </ul>-->
    </div>
</div>

<!--닉네임 수정-->
<div id="nicknameEditPage" style="display:none;">
    <span class="nicknameedit-top">닉네임 수정</span>
    <h2 class="nicknameedit-text">수정할 닉네임을 알려주세요!</h2><br>
    <input type="text" id="nicknameInput" placeholder="닉네임을 입력하세요 0/5" value="{{ user_profile.nickname }}"><br>
    <p id="nicknameError" style="color: red; display: none;">닉네임은 5글자 이내로 작성해주세요.</p><br>
    <button onclick="submitNickname()" class="nicknameedit-complete-btn"><span>완료</span></button><br>
    <button type="button" onclick="showProfilePage()">
        <img src="{% static 'image/chevron-left.png' %}" alt="back-btn" width="18" height="18" class="back-btn"> 
    </button>
</div>

<script>
    function nicknameEdit() {
        document.getElementById('profilePage').style.display = 'none';
        document.getElementById('nicknameEditPage').style.display = 'block';
    }
    
    function showProfilePage() {
        document.getElementById('profilePage').style.display = 'block';
        document.getElementById('nicknameEditPage').style.display = 'none';
    }

    function submitNickname() {
        const nickname = document.getElementById('nicknameInput').value;
        if (nickname.length > 5) {
            document.getElementById('nicknameError').style.display = 'block';
            return;
        }

        fetch("{% url 'plans:update_nickname' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                nickname: nickname
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('userName').innerText = nickname;
                showProfilePage();
            } else {
                document.getElementById('nicknameError').innerText = data.error;
                document.getElementById('nicknameError').style.display = 'block';
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
</script>
{% endblock %}